version: '3.8'

# Arquivo para ambiente de desenvolvimento
# Uso: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  postgres:
    ports:
      - "5432:5432"
    environment:
      # Senhas mais simples para dev
      POSTGRES_PASSWORD: dev123

  petshop-springboot:
    build:
      context: ./backend-springboot
      dockerfile: Dockerfile
      # Build sem cache em dev
      args:
        MAVEN_OPTS: -Dmaven.test.skip=true
    environment:
      SPRING_PROFILES_ACTIVE: dev
      SPRING_DATASOURCE_PASSWORD: dev123
      SPRING_DEVTOOLS_RESTART_ENABLED: "true"
      LOGGING_LEVEL_ROOT: DEBUG
      LOGGING_LEVEL_COM_PETSHOP: DEBUG
    volumes:
      # Hot reload (se configurado)
      - ./backend-springboot/src:/app/src:ro
    ports:
      - "8080:8080"
      - "5005:5005" # Debug port

  petshop-aspnet:
    build:
      context: ./backend-aspnet
      dockerfile: Dockerfile
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ConnectionStrings__DefaultConnection: "Host=postgres;Port=5432;Database=petshop;Username=petshop;Password=dev123"
      Logging__LogLevel__Default: Debug
      Logging__LogLevel__Microsoft: Information
    volumes:
      # Hot reload (se configurado)
      - ./backend-aspnet/PetshopApi:/app:ro
    ports:
      - "5000:5000"

  petshop-frontend:
    volumes:
      # Montar frontend como volume para edição em tempo real
      - ./frontend:/usr/share/nginx/html
      - ./nginx/nginx.dev.conf:/etc/nginx/conf.d/default.conf:ro
    ports:
      - "8081:80"

  # Adminer - Interface Web para PostgreSQL (somente dev)
  adminer:
    image: adminer:latest
    container_name: petshop-adminer
    restart: unless-stopped
    ports:
      - "8082:8080"
    networks:
      - petshop-network
    environment:
      ADMINER_DEFAULT_SERVER: postgres
